<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Manager API Playground</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .sidebar {
            background: white;
            border-radius: 10px;
            padding: 20px;
            height: fit-content;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .content {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .auth-section {
            margin-bottom: 25px;
        }

        .auth-section h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.1rem;
        }

        .auth-inputs {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .input-group label {
            font-size: 0.85rem;
            color: #666;
            font-weight: 500;
        }

        .input-group input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-success:hover {
            background: #38a169;
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-danger:hover {
            background: #e53e3e;
        }

        .btn-warning {
            background: #ed8936;
            color: white;
        }

        .btn-warning:hover {
            background: #dd6b20;
        }

        .token-display {
            margin-top: 15px;
            padding: 10px;
            background: #f7fafc;
            border-radius: 5px;
            word-break: break-all;
            font-family: monospace;
            font-size: 0.85rem;
            display: none;
        }

        .endpoints-section h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .endpoint-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .endpoint-item {
            padding: 12px;
            background: #f7fafc;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .endpoint-item:hover {
            background: #edf2f7;
            border-color: #667eea;
        }

        .endpoint-item.active {
            background: #667eea;
            color: white;
        }

        .method-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.75rem;
            font-weight: bold;
            margin-right: 8px;
        }

        .method-get { background: #48bb78; color: white; }
        .method-post { background: #4299e1; color: white; }
        .method-put { background: #ed8936; color: white; }
        .method-delete { background: #f56565; color: white; }

        .request-section {
            margin-bottom: 25px;
        }

        .request-section h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .url-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .url-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
        }

        .tab-container {
            margin-bottom: 20px;
        }

        .tabs {
            display: flex;
            gap: 5px;
            border-bottom: 2px solid #e2e8f0;
            margin-bottom: 15px;
        }

        .tab {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: #718096;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: #667eea;
            border-bottom: 2px solid #667eea;
            margin-bottom: -2px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .params-container,
        .headers-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .param-row,
        .header-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .param-row input,
        .header-row input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .code-editor {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
        }

        .response-section {
            margin-top: 30px;
        }

        .response-section h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .response-meta {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            padding: 10px;
            background: #f7fafc;
            border-radius: 5px;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
        }

        .status-success { background: #c6f6d5; color: #22543d; }
        .status-error { background: #fed7d7; color: #742a2a; }

        .response-body {
            background: #2d3748;
            color: #fff;
            padding: 20px;
            border-radius: 5px;
            overflow-x: auto;
            max-height: 500px;
            overflow-y: auto;
        }

        .response-body pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .btn-group {
            display: flex;
            gap: 10px;
        }

        .btn-group .btn {
            flex: 1;
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Task Manager API Playground</h1>
            <p>Interactive API testing environment for your Task Management System</p>
        </div>

        <div class="main-grid">
            <div class="sidebar">
                <div class="auth-section">
                    <h3>üîê Authentication</h3>
                    <div class="auth-inputs">
                        <div class="input-group">
                            <label>Email</label>
                            <input type="email" id="auth-email" placeholder="user@example.com">
                        </div>
                        <div class="input-group">
                            <label>Password</label>
                            <input type="password" id="auth-password" placeholder="password">
                        </div>
                        <div class="btn-group" id="auth-buttons">
                            <button class="btn btn-primary" onclick="register()">Register</button>
                            <button class="btn btn-success" onclick="login()">Login</button>
                        </div>
                        <div class="btn-group" id="logout-buttons" style="margin-top: 10px; display: none;">
                            <button class="btn btn-danger" onclick="logout()">Logout</button>
                            <button class="btn btn-warning" onclick="logoutAll()">Logout All</button>
                        </div>
                        <div class="token-display" id="token-display">
                            <strong>Token:</strong>
                            <div id="token-value"></div>
                        </div>
                    </div>
                </div>

                <div class="endpoints-section">
                    <h3>üìã Endpoints</h3>
                    <div class="endpoint-list">
                        <div class="endpoint-item" onclick="selectEndpoint('register')">
                            <span class="method-badge method-post">POST</span>
                            Register
                        </div>
                        <div class="endpoint-item" onclick="selectEndpoint('login')">
                            <span class="method-badge method-post">POST</span>
                            Login
                        </div>
                        <div class="endpoint-item" onclick="selectEndpoint('logout')">
                            <span class="method-badge method-post">POST</span>
                            Logout
                        </div>
                        <div class="endpoint-item" onclick="selectEndpoint('user')">
                            <span class="method-badge method-get">GET</span>
                            User
                        </div>
                        <div class="endpoint-item" onclick="selectEndpoint('users')">
                            <span class="method-badge method-get">GET</span>
                            Users
                        </div>
                        <div class="endpoint-item" onclick="selectEndpoint('getTasks')">
                            <span class="method-badge method-get">GET</span>
                            Get Tasks
                        </div>
                        <div class="endpoint-item" onclick="selectEndpoint('createTask')">
                            <span class="method-badge method-post">POST</span>
                            Create Task
                        </div>
                        <div class="endpoint-item" onclick="selectEndpoint('getTask')">
                            <span class="method-badge method-get">GET</span>
                            Get Task
                        </div>
                        <div class="endpoint-item" onclick="selectEndpoint('updateTask')">
                            <span class="method-badge method-put">PUT</span>
                            Update Task
                        </div>
                        <div class="endpoint-item" onclick="selectEndpoint('deleteTask')">
                            <span class="method-badge method-delete">DELETE</span>
                            Delete Task
                        </div>
                    </div>
                </div>
            </div>

            <div class="content">
                <div class="request-section">
                    <h3>Request</h3>
                    <div class="url-bar">
                        <select id="method-select" style="padding: 12px; border: 1px solid #ddd; border-radius: 5px;">
                            <option value="GET">GET</option>
                            <option value="POST">POST</option>
                            <option value="PUT">PUT</option>
                            <option value="DELETE">DELETE</option>
                        </select>
                        <input type="text" class="url-input" id="url-input" value="http://127.0.0.1:8000/api/tasks">
                        <button class="btn btn-primary" onclick="sendRequest()" id="send-btn">Send Request</button>
                    </div>

                    <div class="tab-container">
                        <div class="tabs">
                            <button class="tab active" onclick="switchTab('params')">Query Params</button>
                            <button class="tab" onclick="switchTab('headers')">Headers</button>
                            <button class="tab" onclick="switchTab('body')">Body</button>
                        </div>

                        <div class="tab-content active" id="params-tab">
                            <div class="params-container" id="params-container">
                                <div class="param-row">
                                    <input type="text" placeholder="Key" id="param-key">
                                    <input type="text" placeholder="Value" id="param-value">
                                    <button class="btn btn-primary" onclick="addParam()">Add</button>
                                </div>
                            </div>
                        </div>

                        <div class="tab-content" id="headers-tab">
                            <div class="headers-container" id="headers-container">
                                <div class="header-row">
                                    <input type="text" value="Content-Type" disabled>
                                    <input type="text" value="application/json" disabled>
                                </div>
                                <div class="header-row">
                                    <input type="text" value="Accept" disabled>
                                    <input type="text" value="application/json" disabled>
                                </div>
                                <div class="header-row" id="auth-header" style="display: none;">
                                    <input type="text" value="Authorization" disabled>
                                    <input type="text" id="auth-header-value" value="" disabled>
                                </div>
                            </div>
                        </div>

                        <div class="tab-content" id="body-tab">
                            <textarea class="code-editor" id="request-body" placeholder='{"key": "value"}'>{
                                "title": "Sample Task",
                                "description": "This is a sample task",
                                "status": "pending",
                                "deadline": "2025-12-31 23:59:59"
                            }</textarea>
                        </div>
                    </div>
                </div>

                <div class="response-section">
                    <h3>Response</h3>
                    <div class="response-meta" id="response-meta" style="display: none;">
                        <div>
                            Status: <span class="status-badge" id="status-badge">-</span>
                        </div>
                        <div>
                            Time: <span id="response-time">-</span>
                        </div>
                        <div>
                            Size: <span id="response-size">-</span>
                        </div>
                    </div>
                    <div class="response-body">
                        <pre id="response-content">Send a request to see the response here...</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let authToken = localStorage.getItem('auth_token') || '';
        let currentParams = [];

        // Initialize
        window.onload = function() {
            if (authToken) {
                showAuthToken();
            }
        };

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        function showAuthToken() {
            document.getElementById('token-display').style.display = 'block';
            document.getElementById('token-value').textContent = authToken.substring(0, 50) + '...';
            document.getElementById('auth-header').style.display = 'flex';
            document.getElementById('auth-header-value').value = `Bearer ${authToken}`;
            // Hide login/register buttons and show logout buttons
            document.getElementById('auth-buttons').style.display = 'none';
            document.getElementById('logout-buttons').style.display = 'flex';
        }

        function hideAuthToken() {
            document.getElementById('token-display').style.display = 'none';
            document.getElementById('auth-header').style.display = 'none';
            // Show login/register buttons and hide logout buttons
            document.getElementById('auth-buttons').style.display = 'flex';
            document.getElementById('logout-buttons').style.display = 'none';
        }

        async function register() {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            
            // Validation
            if (!email || !password) {
                alert('Please enter email and password');
                return;
            }
            
            if (!email.includes('@') || !email.includes('.')) {
                alert('Please enter a valid email address');
                return;
            }
            
            if (password.length < 6) {
                alert('Password must be at least 6 characters long');
                return;
            }

            const response = await sendApiRequest('POST', 'http://127.0.0.1:8000/api/register', {
                name: email.split('@')[0],
                email: email,
                password: password
            });

            if (response && response.success) {
                alert('Registration successful! Please login.');
                // Clear the form
                document.getElementById('auth-email').value = '';
                document.getElementById('auth-password').value = '';
            }
        }

        async function login() {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            
            // Validation
            if (!email || !password) {
                alert('Please enter email and password');
                return;
            }
            
            if (!email.includes('@') || !email.includes('.')) {
                alert('Please enter a valid email address');
                return;
            }

            const response = await sendApiRequest('POST', 'http://127.0.0.1:8000/api/login', {
                email: email,
                password: password
            });

            if (response && response.access_token) {
                authToken = response.access_token;
                localStorage.setItem('auth_token', authToken);
                showAuthToken();
                alert('Login successful!');
                // Clear the form
                document.getElementById('auth-email').value = '';
                document.getElementById('auth-password').value = '';
            }
        }

        async function logout() {
            const response = await sendApiRequest('POST', 'http://127.0.0.1:8000/api/logout', {});
            
            authToken = '';
            localStorage.removeItem('auth_token');
            hideAuthToken();
            alert('Logged out successfully!');
        }

        async function logoutAll() {
            const response = await sendApiRequest('POST', 'http://127.0.0.1:8000/api/logout-all', {});
            
            authToken = '';
            localStorage.removeItem('auth_token');
            hideAuthToken();
            alert('All sessions logged out successfully!');
        }

        function checkAuthEndpoint(endpoint) {
            const authEndpoints = ['register', 'login', 'logout', 'logoutall'];
            return authEndpoints.includes(endpoint);
        }

        function selectEndpoint(endpoint) {
            document.querySelectorAll('.endpoint-item').forEach(item => item.classList.remove('active'));
            event.target.closest('.endpoint-item').classList.add('active');

            // Disable/enable send button based on endpoint
            const sendBtn = document.getElementById('send-btn');
            if (checkAuthEndpoint(endpoint)) {
                sendBtn.disabled = true;
                sendBtn.style = {
                    cursor: 'not-allowed',
                    opacity: '0.5'
                };
                sendBtn.textContent = 'Use Auth Buttons Instead';
            } else {
                sendBtn.style = {
                    cursor: 'ponter',
                    opacity: '1'
                };
                sendBtn.disabled = false;
                sendBtn.textContent = 'Send Request';
            }

            const endpoints = {
                'register': {
                    method: 'POST',
                    url: 'http://127.0.0.1:8000/api/register',
                    body: {
                        name: "John Doe",
                        email: "john@example.com",
                        password: "password123"
                    }
                },
                'login': {
                    method: 'POST',
                    url: 'http://127.0.0.1:8000/api/login',
                    body: {
                        email: "john@example.com",
                        password: "password123"
                    }
                },
                'logout': {
                    method: 'POST',
                    url: 'http://127.0.0.1:8000/api/logout',
                    body: {}
                },
                'user': {
                    method: 'GET',
                    url: 'http://127.0.0.1:8000/api/user',
                    body: null
                },
                'users': {
                    method: 'GET',
                    url: 'http://127.0.0.1:8000/api/users',
                    body: null
                },
                'getTasks': {
                    method: 'GET',
                    url: 'http://127.0.0.1:8000/api/tasks',
                    body: null
                },
                'createTask': {
                    method: 'POST',
                    url: 'http://127.0.0.1:8000/api/tasks',
                    body: {
                        title: "New Task",
                        description: "Task description",
                        status: "pending",
                        deadline: "2025-12-31 23:59:59"
                    }
                },
                'getTask': {
                    method: 'GET',
                    url: 'http://127.0.0.1:8000/api/tasks/1',
                    body: null
                },
                'updateTask': {
                    method: 'PUT',
                    url: 'http://127.0.0.1:8000/api/tasks/1',
                    body: {
                        title: "Updated Task",
                        description: "Updated description",
                        status: "in_progress"
                    }
                },
                'deleteTask': {
                    method: 'DELETE',
                    url: 'http://127.0.0.1:8000/api/tasks/1',
                    body: null
                }
            };

            const config = endpoints[endpoint];
            if (config) {
                document.getElementById('method-select').value = config.method;
                document.getElementById('url-input').value = config.url;
                if (config.body) {
                    document.getElementById('request-body').value = JSON.stringify(config.body, null, 2);
                } else {
                    document.getElementById('request-body').value = '';
                }
            }
        }

        function addParam() {
            const key = document.getElementById('param-key').value;
            const value = document.getElementById('param-value').value;
            
            if (key && value) {
                currentParams.push({key, value});
                updateUrlWithParams();
                document.getElementById('param-key').value = '';
                document.getElementById('param-value').value = '';
                displayParams();
            }
        }

        function displayParams() {
            const container = document.getElementById('params-container');
            container.innerHTML = `
                <div class="param-row">
                    <input type="text" placeholder="Key" id="param-key">
                    <input type="text" placeholder="Value" id="param-value">
                    <button class="btn btn-primary" onclick="addParam()">Add</button>
                </div>
            `;
            
            currentParams.forEach((param, index) => {
                const row = document.createElement('div');
                row.className = 'param-row';
                row.innerHTML = `
                    <input type="text" value="${param.key}" disabled>
                    <input type="text" value="${param.value}" disabled>
                    <button class="btn btn-danger" onclick="removeParam(${index})">Remove</button>
                `;
                container.appendChild(row);
            });
        }

        function removeParam(index) {
            currentParams.splice(index, 1);
            updateUrlWithParams();
            displayParams();
        }

        function updateUrlWithParams() {
            const baseUrl = document.getElementById('url-input').value.split('?')[0];
            if (currentParams.length > 0) {
                const queryString = currentParams.map(p => `${p.key}=${encodeURIComponent(p.value)}`).join('&');
                document.getElementById('url-input').value = `${baseUrl}?${queryString}`;
            } else {
                document.getElementById('url-input').value = baseUrl;
            }
        }

        async function sendRequest() {
            const method = document.getElementById('method-select').value;
            const url = document.getElementById('url-input').value;
            const bodyText = document.getElementById('request-body').value;
            
            let body = null;
            if (method !== 'GET' && method !== 'DELETE' && bodyText) {
                try {
                    body = JSON.parse(bodyText);
                } catch (e) {
                    alert('Invalid JSON in request body');
                    return;
                }
            }

            await sendApiRequest(method, url, body);
        }

        async function sendApiRequest(method, url, body) {
            const startTime = Date.now();
            const sendBtn = document.getElementById('send-btn');
            sendBtn.innerHTML = '<span class="loading"></span>';
            sendBtn.disabled = true;

            try {
                const headers = {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                };

                if (authToken) {
                    headers['Authorization'] = `Bearer ${authToken}`;
                }

                const options = {
                    method: method,
                    headers: headers
                };

                if (body && method !== 'GET') {
                    options.body = JSON.stringify(body);
                }

                const response = await fetch(url, options);
                const responseTime = Date.now() - startTime;
                const responseText = await response.text();
                
                let responseData;
                try {
                    responseData = JSON.parse(responseText);
                } catch (e) {
                    responseData = responseText;
                }

                // Update response display
                document.getElementById('response-meta').style.display = 'flex';
                document.getElementById('status-badge').textContent = response.status;
                document.getElementById('status-badge').className = response.ok ? 'status-badge status-success' : 'status-badge status-error';
                document.getElementById('response-time').textContent = `${responseTime}ms`;
                document.getElementById('response-size').textContent = `${new Blob([responseText]).size} bytes`;
                document.getElementById('response-content').textContent = JSON.stringify(responseData, null, 2);

                return responseData;

            } catch (error) {
                document.getElementById('response-meta').style.display = 'flex';
                document.getElementById('status-badge').textContent = 'ERROR';
                document.getElementById('status-badge').className = 'status-badge status-error';
                document.getElementById('response-content').textContent = `Error: ${error.message}`;
                return null;
            } finally {
                sendBtn.innerHTML = 'Send Request';
                sendBtn.disabled = false;
            }
        }
    </script>
</body>
</html>